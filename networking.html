
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Networking &#8212; Hades 0.4.0-180-g86b2a9b documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/guzzle.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Replication" href="replication.html" />
    <link rel="prev" title="Components" href="components.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="replication.html" title="Replication"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="components.html" title="Components"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Hades 0.4.0-180-g86b2a9b documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Networking</a></li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="components.html">Components</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Networking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#network-namespaces">Network Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vlan-transitions">VLAN Transitions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="alternative-dns.html">Alternative DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/hades.html">Code Documentation</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="index.html">Docs</a></li>
              
              <li>Networking</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <section id="networking">
<span id="id1"></span><h1>Networking<a class="headerlink" href="#networking" title="Permalink to this headline">¶</a></h1>
<p>Hades was designed specifically for the needs of the AG DSN.
It may not be suited perfectly for other networks without changes.
In principal a network topology with four different types of IP subnets was
assumed/is supported:</p>
<ol class="arabic simple">
<li><p>internal subnets: Subnets for internal services that should not be exposed
to users, e.g. RADIUS, VRRP</p></li>
<li><p>an unauth subnet: A private subnet for all unauthorized users of a site.
DNS, DHCP and a captive portal are offered on this network</p></li>
<li><p>an auth subnet: The subnet where the site node listens to offer services to
authorized users, e.g. DNS and DHCP</p></li>
<li><p>the user subnets: The actual subnets of authorized users</p></li>
</ol>
<p>A Hades site note is expected to be directly attached to the first three types
of subnets (internal, unauth, auth).</p>
<section id="network-namespaces">
<h2>Network Namespaces<a class="headerlink" href="#network-namespaces" title="Permalink to this headline">¶</a></h2>
<p>The network requirements of Had.</p>
<p>For example, normal
Due to the complexity of the networking, Hades uses network namespaces.</p>
<p>For more information about network namespaces, please see the namespaces man
pages
<a class="reference external" href="https://manpages.debian.org/stretch/manpages/namespaces.7.en.html">namespaces(7)</a>,
<a class="reference external" href="https://manpages.debian.org/stretch-backports/manpages/network_namespaces.7.en.html">network_namespaces(7)</a>,
and the <code class="docutils literal notranslate"><span class="pre">iproute2</span></code> man page about <code class="docutils literal notranslate"><span class="pre">netns</span></code> subcommand of <code class="docutils literal notranslate"><span class="pre">ip</span></code> to manage
named network namespaces
<a class="reference external" href="https://manpages.debian.org/stretch/iproute2/ip-netns.8.en.html">ip-netns(8)</a>.</p>
</section>
<section id="vlan-transitions">
<h2>VLAN Transitions<a class="headerlink" href="#vlan-transitions" title="Permalink to this headline">¶</a></h2>
<p>The authorization status of users may change, previously authorized users may
become unauthorized and subsequently switch from the auth network to the unauth
network. Users or rather the network stack of their devices won't notice this
switch and retain their previously assigned IP address. This could be handled
with short DHCP lease times, short lease times are however not recommended.
<a class="reference external" href="https://tools.ietf.org/html/rfc2131">RFC 2131</a>
recommends a minimum lease time of one hour for production systems.</p>
<p>In Hades we handle this problem differently, by allowing the user to retain
their original user network IP in the unauth network. This is accomplished by
adding the IP addresses of the default gateways of the user networks to the
unauth interface. In addition gratuitous ARP requests are broadcasted
periodically to notify the users that the MAC address of the default gateway
has changed.</p>
<p>This approach works, but has a big problem. Authenticated users also make
requests (DNS and DHCP) to the site node. The Kernel would either discard these
requests if strict reverse path forwarding/filtering is enabled, because the
requests are arriving on the wrong interface according to the Kernel's routing
table (because the Kernel thinks requests from the user networks should arrive
on the unauth interface), or replies to the requests would be sent out on the
unauth interface.</p>
<p>How can we handle this? We would have to route replies for connections from IP
addresses in the user networks depending on which interface a connection (not a
packet) originated from. This is exactly what we do using policy routing. Hades
sets up two different routing tables, one for connections originating from the
unauth interface (default table id 2) and one for any other connection (default
table id 1). The main routing table of the Kernel is only used as a template to
setup the other tables.</p>
</section>
</section>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="components.html" title="previous chapter (use the left arrow)">Components</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="replication.html" title="next chapter (use the right arrow)">Replication</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="replication.html" title="Replication"
             >next</a> |</li>
        <li class="right" >
          <a href="components.html" title="Components"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Hades 0.4.0-180-g86b2a9b documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Networking</a></li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2015-2020, Sebastian Schrader, Stefan Haller. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>