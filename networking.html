<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Networking &mdash; Hades 0.1.0-175-gbe2bc56 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0-175-gbe2bc56',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Hades 0.1.0-175-gbe2bc56 documentation" href="index.html" />
    <link rel="prev" title="Components" href="components.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="networking">
<h1>Networking<a class="headerlink" href="#networking" title="Permalink to this headline">¶</a></h1>
<p>Hades was designed with the AG DSN network topology in mind.
In principal four different types of IP subnets were assumed/are supported:</p>
<ul class="simple">
<li>internal subnets: Subnet for internal services that should not be exposed
to users, e.g. RADIUS, VRRP</li>
<li>an unauth subnet: A private subnet for all unauthorized users of a site.
DNS, DHCP and a captive portal are offered on this network</li>
<li>an auth subnet: The subnet where the site node listens to offer services to
authorized users, e.g. DNS and DHCP</li>
<li>the user subnets: The actual subnets of authorized users</li>
</ul>
<p>A Hades site note is expected to be directly attached to the first three types
of subnets (internal, unauth, auth).
A site node must not be attached directly to the user subnets.
Authenticated users must therefore be routed to the site node.
This is due to VLAN transitions.</p>
<div class="section" id="vlan-transitions">
<h2>VLAN Transitions<a class="headerlink" href="#vlan-transitions" title="Permalink to this headline">¶</a></h2>
<p>The authorization status of users may change, previously authorized users may
become unauthorized and subsequently switch from the auth network to the unauth
network. Users or rather the network stack of their devices won&#8217;t notice this
switch and retain their previously assigned IP address. This could be handled
with short DHCP lease times, short lease times are however not recommended.
RFC 2131 recommends a minimum lease time of one hour for production systems.</p>
<p>In Hades we handle this problem differently, by allowing the user to retain
their original user network IP in the unauth network. This is accomplished by
adding the IP addresses of the default gateways of the user networks to the
unauth interface. In addition gratuitous ARP requests are broadcasted
periodically to notify the users that the MAC address of the default gateway
has changed.</p>
<p>This approach works, but has a big problem. Authenticated users also make
requests (DNS and DHCP) to the site node. The Kernel would either discard these
requests if strict reverse path forwarding/filtering is enabled, because the
requests are arriving on the wrong interface according to the Kernel&#8217;s routing
table (because the Kernel thinks requests from the user networks should arrive
on the unauth interface), or replies to the requests would be sent out on the
unauth interface.</p>
<p>How can we handle this? We would have to route replies for connections from IP
addresses in the user networks depending on which interface a connection (not a
packet) originated from. This is exactly what we do using policy routing. Hades
sets up two different routing tables, one for connections originating from the
unauth interface (default table id 2) and one for any other connection (default
table id 1). The main routing table of the Kernel is only used as a template to
setup the other tables.</p>
</div>
<div class="section" id="fail-over-vrrp">
<h2>Fail-Over (VRRP)<a class="headerlink" href="#fail-over-vrrp" title="Permalink to this headline">¶</a></h2>
<p>Hades employs the Virtual Router Redundancy Protocol (VRRP) to allow multiple
site node instances for a single sites.
It uses keepalived</p>
<p>Even if there is only a single site node instance per site, keepalived is still
started to setup most of the network configuration.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Networking</a><ul>
<li><a class="reference internal" href="#vlan-transitions">VLAN Transitions</a></li>
<li><a class="reference internal" href="#fail-over-vrrp">Fail-Over (VRRP)</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="components.html" title="previous chapter">Components</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/networking.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Arbeitsgemeinschaft Dresdner Studentennetz (AG DSN), Sebastian Schrader.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/networking.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>