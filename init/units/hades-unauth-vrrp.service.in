[Unit]
Description=Hades VRRP service for unauth services (keepalived)
Documentation=https://agdsn.github.io/hades/
#PartOf=hades.target
After=hades-network.service
Wants=hades-network.service

[Service]
Type=forking
PIDFile=@PKGRUNSTATEDIR@/unauth-vrrp/keepalived.pid
KillMode=process
SyslogIdentifier=hades-unauth-vrrp
EnvironmentFile=@SYSTEMDENVDIR@/hades
ExecStartPre=@VENVDIR@/bin/hades-generate-config unauth-keepalived.conf.j2 @PKGRUNSTATEDIR@/unauth-vrrp/keepalived.conf
ExecStart=@IP@ netns exec unauth @KEEPALIVED@ --log-console --vrrp --use-file=@PKGRUNSTATEDIR@/unauth-vrrp/keepalived.conf --pid=@PKGRUNSTATEDIR@/unauth-vrrp/keepalived.pid --vrrp_pid=@PKGRUNSTATEDIR@/unauth-vrrp/keepalived-vrrp.pid
ExecReload=@VENVDIR@/bin/hades-generate-config unauth-keepalived.conf.j2 @PKGRUNSTATEDIR@/unauth-vrrp/keepalived.conf
ExecReload=@KILL@ -HUP $MAINPID
Restart=always
RestartSec=5
