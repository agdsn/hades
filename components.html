<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Components &mdash; Hades 0.1.0-177-g0b187d3 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0-177-g0b187d3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Hades 0.1.0-177-g0b187d3 documentation" href="index.html" />
    <link rel="next" title="Networking" href="networking.html" />
    <link rel="prev" title="Hades" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="components">
<h1>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h1>
<p>Hades consists of quite a number of different components:</p>
<ul class="simple">
<li>A database (PostgresSQL)</li>
<li>A RADIUS server (freeRADIUS)</li>
<li>A DNS resolver for authorized users (unbound)</li>
<li>A DHCP server for authorized users (dnsmasq)</li>
<li>A DNS resolver for unauthorized users (again dnsmasq, but a separate instance)</li>
<li>A DHCP server for unauthorized users (again dnsmasq, but same instance as unauthorized DNS)</li>
<li>An agent executing regular tasks and waiting for commands (Celery worker)</li>
<li>A Flask web application providing a captive portal landing page</li>
<li>An WSGI application server (uwsgi) hosting the Flask application</li>
<li>A web server (nginx) forwarding requests to the application server</li>
<li>A VRRP server (keepalived) providing automatic fail-over between multiple Hades installations</li>
</ul>
<p>All components are intended to be run on the same machine to a serve a set of
users. This group of users form the called a site and the machine is called the
site node. Multiple instances of Hades can be run for the same site, whereby
one node is primary and other nodes serve as secondary backup nodes.</p>
<div class="section" id="database-postgresql">
<h2>Database (PostgreSQL)<a class="headerlink" href="#database-postgresql" title="Permalink to this headline">¶</a></h2>
<p>PostgreSQL was chosen as the backend database, because it&#8217;s very mature
database, all other components support it as a backend and its Foreign Data
Wrapper combined with Materialized Views are a very simple and robust way to
implement asynchronous replication.</p>
</div>
<div class="section" id="radius-freeradius">
<h2>RADIUS (freeRADIUS)<a class="headerlink" href="#radius-freeradius" title="Permalink to this headline">¶</a></h2>
<p>freeRADIUS is the de facto standard RADIUS open source server implementation.
All other alternatives are less supported on different platforms and don&#8217;t
offer nearly as much features.</p>
<p>The generated configuration is for the 2.x line of freeRADIUS as the new 3.x
has not been packaged yet in Debian, which is the target platform of Hades.</p>
<p>Most modules and features of freeRADIUS have been disabled to only support
RADIUS MAC Authentication (or MAC Authentication Bypass) via PAP, CHAP and
EAP-MD5. The interoperability has only been verified with HP ProCurve switches,
patches for different lines of hardware are welcome.</p>
</div>
<div class="section" id="auth-dns-unbound">
<h2>Auth DNS (unbound)<a class="headerlink" href="#auth-dns-unbound" title="Permalink to this headline">¶</a></h2>
<p>DNS for authenticated users is provided by unbound.
The unbound instance has DNSSEC-enabled.
In the default configuration unbound runs as a standalone, recursive resolver.</p>
<p>dnsmasq could have been chosen as the resolver for authenticated as well, but it
its not capable of recursively resolving names itself and always needs a set of
upstream DNS servers to forward requests to.</p>
</div>
<div class="section" id="auth-dhcp-dnsmasq">
<h2>Auth DHCP (dnsmasq)<a class="headerlink" href="#auth-dhcp-dnsmasq" title="Permalink to this headline">¶</a></h2>
<p>Hades currently uses dnsmasq as the DHCP server for authenticated users.
The well-known ISC DHCP server has not been chosen, because without patches, it
doesn&#8217;t support reading static host reservations from a database.
dnsmasq does not support reading from a database either, but can be instructed
to reload its host reservations from disk without restarting.
ISC dhcpd must always be restarted.</p>
<p>There is a new DHCP server called kea also developed by ISC, which would be the
perfect fit for Hades, as it will support reading host reservations from
a relational database.
Unfortunately kea is still in development and this particular feature is not
yet fully implemented.
See <a class="reference external" href="https://kea.isc.org/wiki/HostReservationDesign">https://kea.isc.org/wiki/HostReservationDesign</a> for the current state of
affairs.</p>
</div>
<div class="section" id="unauth-dns-dnsmasq">
<h2>Unauth DNS (dnsmasq)<a class="headerlink" href="#unauth-dns-dnsmasq" title="Permalink to this headline">¶</a></h2>
<p>The DNS server for unauthenticated users is a vital part of the captive portal
redirection.
It will respond to any DNS request with the unauth listen IP of the site node.
dnsmasq is very well suited for this unusual configuration.</p>
<p>There is a special entry for dns.msftncsi.com to assist with the Network
Connectivity Status Indicator service used in Microsoft products, such as
Windows.</p>
</div>
<div class="section" id="unauth-dhcp-dnsmasq">
<h2>Unauth DHCP (dnsmasq)<a class="headerlink" href="#unauth-dhcp-dnsmasq" title="Permalink to this headline">¶</a></h2>
<p>The same dnsmasq process that provides unauth DNS provides unauth DHCP.
In this network users are given very short leases (two minutes is the default
values), so that they will renew their IP address very often and get an regular
after transitioning back into the network for authenticated users very quickly.</p>
</div>
<div class="section" id="site-agent-celery">
<h2>Site Agent (Celery)<a class="headerlink" href="#site-agent-celery" title="Permalink to this headline">¶</a></h2>
<p>Other internal services and applications might want to contact the site node to
get a list of the latest authentication attempts at a particular switch port for
example.
Direct communication in a distributed system, such as Hades with potentially
many site nodes is therefore facilitated with the use of a central message queue
and the distributed task framework Celery.
The central message queue or broker is <strong>not</strong> part of Hades.
RabbitMQ or Redis is recommended.
Please see the <cite>Celery Broker documentation &lt;https://celery.readthedocs.org/en/latest/getting-started/brokers/index.html&gt;</cite></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Components</a><ul>
<li><a class="reference internal" href="#database-postgresql">Database (PostgreSQL)</a></li>
<li><a class="reference internal" href="#radius-freeradius">RADIUS (freeRADIUS)</a></li>
<li><a class="reference internal" href="#auth-dns-unbound">Auth DNS (unbound)</a></li>
<li><a class="reference internal" href="#auth-dhcp-dnsmasq">Auth DHCP (dnsmasq)</a></li>
<li><a class="reference internal" href="#unauth-dns-dnsmasq">Unauth DNS (dnsmasq)</a></li>
<li><a class="reference internal" href="#unauth-dhcp-dnsmasq">Unauth DHCP (dnsmasq)</a></li>
<li><a class="reference internal" href="#site-agent-celery">Site Agent (Celery)</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Hades</a></li>
      <li>Next: <a href="networking.html" title="next chapter">Networking</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/components.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Arbeitsgemeinschaft Dresdner Studentennetz (AG DSN), Sebastian Schrader.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/components.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>